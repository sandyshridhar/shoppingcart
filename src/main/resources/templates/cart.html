<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Index</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:href="@{/style.css}" rel="stylesheet" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>
<body style="background-color:#f1f1f1" onload="renderCartTable()">

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Logo</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
<!--                <li><a th:href="@{/addproduct}"><span class="glyphicon glyphicon-log-in"></span>Add Product</a></li>-->
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-center">
    <div class="row content"><br>
        <div class="col-sm-1 sidenav">
        </div>
        <div class="col-sm-10 sidenav text-left" style="background-color:white">
            <form th:action="@{/savecart}" method="POST" th:object="${userInfo}" th:onsubmit="return submitform()">
                <div class="col-sm-1"></div>
                <div class="col-sm-10">
                    <h4>User Information.</h4>
                    <div class="form-group row">
                        <div class="col-xs-6">
                            <label >First Name</label>
                            <input class="form-control"  type="text" name="fname"    >
                        </div>
                        <div class="col-xs-6">
                            <label >Last Name</label>
                            <input class="form-control"  type="text" name="lname"  >
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xs-6">
                            <label >Email</label>
                            <input class="form-control"  type="email" name="email"   >
                        </div>
                        <div class="col-xs-6">
                            <label >Number</label>
                            <input class="form-control"  type="number" name="number"   >
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xs-6">
                            <label >State</label>
                            <input class="form-control"  type="text" name="state"   >
                        </div>
                        <div class="col-xs-6">
                            <label >City</label>
                            <input class="form-control"  type="text" name="city"   >
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xs-6">
                            <label >Pincode</label>
                            <input class="form-control"  type="number" name="pincode"   >
                        </div>

                    </div>
                </div>
                <div class="col-sm-1"></div>
                <br>
                <div class="col-sm-12">
                    <h4>Cart Item's.</h4>
                    <div id="cartresult" th:object="${orderProduct}"></div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-8">
                            <button type="submit" class="btn btn-primary btn-block" >Order</button>
                        </div>
                    </div>
                </div>
            </form>
            <br>
        </div>
        <div class="col-sm-1 sidenav">
        </div>
    </div>
</div>

<footer class="container-fluid text-center">
    <p>Footer Text</p>
</footer>
<script>

    function renderCartTable(){
        let cart = JSON.parse(sessionStorage.getItem("myCart"));
        var ele = document.getElementById("cartresult");
        ele.innerHTML = '';
        console.log(cart);
        var html = '';
        html += "<table id='tblCart' border='1|1' class='table table-bordered'>";
        html += "<tr><td>Product Name</td>";
        html += "<td>Quantity</td>";
        html += "<td>Price</td>";
        html += "<td>Total</td>";
        html += "<td>Action</td></tr>";
            var GrandTotal = 0;
            for (var i = 0; i < cart.length; i++) {
            html += "<tr>";
            var p_name = cart[i].product.product_name;

            html += "<td><input class='cartinput' readonly type='text' name='orderProduct[\""+i+"\"].p_name' value='"+p_name+"' /></td>";
            html += "<td><input type='button' value='-' onClick='subtractQuantity(\"" + cart[i].product.product_id + "\", this);'/><input class='cartinput' readonly type='text' name='orderProduct[\""+i+"\"].p_qty' value='" + cart[i].product_qty + "'/><input type='button' value='+' onClick='addQuantity(\"" + cart[i].product.product_id + "\", this);'/></td>";
            html += "<td><input class='cartinput' readonly type='text' name='orderProduct[\""+i+"\"].p_price' value='" + cart[i].product.product_price + "'/></td>";
            html += "<td>" + parseFloat(cart[i].product.product_price) * parseInt(cart[i].product_qty) + "</td>";
            html += "<td><input type='button' value='Remove Item' onClick='removeItem(\"" + cart[i].product.product_id + "\", this);'/></td>";
            html += "</tr>";

            GrandTotal += parseFloat(cart[i].product.product_price) * parseInt(cart[i].product_qty);

            }
<!--            document.getElementById('demo3').innerHTML = GrandTotal;-->
            html += "</table>";
            ele.innerHTML = html;
    };


function submitform() {
   let value =	sessionStorage.removeItem("myCart");
   return true;
}


        function removeItem(product_id)
        {
            let sessioncart = JSON.parse(sessionStorage.getItem("myCart"));
            for (var i = 0; i < sessioncart.length; i++) {
                if (sessioncart[i].product.product_id == product_id) {
                    sessioncart.splice(i,1);
                }
            }
            sessionStorage.setItem("myCart", JSON.stringify(sessioncart));
            renderCartTable();
        }
    function addQuantity(product_id)
        {
        let sessioncart = JSON.parse(sessionStorage.getItem("myCart"));
            for (var i = 0; i < sessioncart.length; i++) {
                if (sessioncart[i].product.product_id == product_id) {
                    sessioncart[i].product_qty++;
                }
            }
            sessionStorage.setItem("myCart", JSON.stringify(sessioncart));
            renderCartTable();
        }

    function subtractQuantity(product_id)
        {
        let sessioncart = JSON.parse(sessionStorage.getItem("myCart"));
            for (var i = 0; i < sessioncart.length; i++) {
                if (sessioncart[i].product.product_id == product_id) {
                    sessioncart[i].product_qty--;
                }

                if (sessioncart[i].product_qty == 0) {
                    sessioncart.splice(i,1);
                }
            }
            sessionStorage.setItem("myCart", JSON.stringify(sessioncart));
            renderCartTable();
        }



</script>
</body>
</html>
