<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" >
<head>
    <title>Admin Index</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:href="@{/style.css}" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>
<body style="background-color:#f1f1f1" th:onload="addProduct()">

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Logo</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-center">
    <div class="row content"><br>
        <div class="col-sm-12 text-left" style="background-color:white">
                <div th:if!="${allproduct.isEmpty()}">
                    <div class="col-sm-4" th:each="p:${allproduct}">
                        <div class="card" >
                            <p th:text="${p.id}" id="pid" hidden="hidden"></p>
                            <img th:src="@{images/bag.jpg;base64}" alt="Bag's" style="width:100%">
                            <h3 th:text="${p.p_name}" id="p_name"></h3>
                            <p class="price" th:text="${p.p_price}" id="p_price"></p>
                            <br>
                            <p><a th:href="@{/cart}"><button class="btn btn-info btn-xs" th:onclick="return addCart([[${p.id}]], this);" >Add to Cart</button></a>
                            </p>
                        </div>
                    </div>
                </div>
            <div th:if="${allproduct.isEmpty()}">
                <h2>Sorry:(  No items are available at...</h2>
            </div>
        </div>
<!--        <div class="col-sm-4 sidenav">-->
<!--            <p id="demo"></p> <br/>-->
<!--            <p id="demo2"></p>-->
<!--            <h2>Grand Total:</h2>-->
<!--            <p id="demo3"></p>-->
<!--        </div>    -->
    </div>
</div>

<footer class="container-fluid text-center">
    <p>Footer Text</p>
</footer>
<script>
    var products = [];
    var cart = [];
    function addProduct() {

        const id = document.querySelectorAll("[id='pid']");
        const name = document.querySelectorAll("[id='p_name']");
        const price = document.querySelectorAll("[id='p_price']");

            for(var i=0;i<id.length;i++){
            var newProduct = {
                product_id: null,
                product_name: null,
                product_qty: 1,
                product_price: 0.00,
            };
            newProduct.product_id = id[i].innerHTML;
            newProduct.product_name = name[i].innerHTML;
            newProduct.product_price = price[i].innerHTML;
            products.push(newProduct);
            };
    }

    function addCart(product_id) {
            for (var i = 0; i < products.length; i++) {
                if (products[i].product_id == product_id) {
                    var cartItem = null;
                    for (var k = 0; k < cart.length; k++) {
                        if (cart[k].product.product_id == products[i].product_id) {
                            cartItem = cart[k];
                            cart[k].product_qty++;
                            break;
                        }
                    }
                    if (cartItem == null) {
                        var cartItem = {
                            product: products[i],
                            product_qty: products[i].product_qty
                        };
                        cart.push(cartItem);
                    }
                }
            }
            sessionStorage.setItem("myCart", JSON.stringify(cart));
            console.log(cart);
            return true;
        }



</script>
</body>
</html>
